<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.68.3" />
  
    

    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Sohn Dangen" />
    <meta property="og:url" content="https://dangen-effy.github.io/post/%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EC%A7%81%EC%A0%91-%EA%B5%AC%EC%84%B1%ED%95%98%EA%B8%B0-%EB%A1%9C%EA%B7%B8%EA%B0%80-%EC%9E%AC%EC%82%B0%EC%9D%B4%EB%8B%A4/" />
    <link rel="canonical" href="https://dangen-effy.github.io/post/%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EC%A7%81%EC%A0%91-%EA%B5%AC%EC%84%B1%ED%95%98%EA%B8%B0-%EB%A1%9C%EA%B7%B8%EA%B0%80-%EC%9E%AC%EC%82%B0%EC%9D%B4%EB%8B%A4/" /><link rel="shortcut icon" href="/favicon.ico" type="image/x-png" /><script type="application/ld+json">
  {
      "@context" : "http://schema.org",
      "@type" : "BlogPosting",
      "mainEntityOfPage": {
           "@type": "WebPage",
           "@id": "https:\/\/dangen-effy.github.io\/"
      },
      "articleSection" : "post",
      "name" : "ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ í´ëŸ¬ìŠ¤í„° ì§ì ‘ êµ¬ì„±í•˜ê¸° - ë¡œê·¸ê°€ ì¬ì‚°ì´ë‹¤",
      "headline" : "ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ í´ëŸ¬ìŠ¤í„° ì§ì ‘ êµ¬ì„±í•˜ê¸° - ë¡œê·¸ê°€ ì¬ì‚°ì´ë‹¤",
      "description" : "ë„ì»¤ ì»´í¬ì¦ˆë¡œ ì—˜ë¼ìŠ¤í‹± ì„œì¹˜ í´ëŸ¬ìŠ¤í„°ë¥¼ ë„ì›Œë´…ì‹œë‹¤",
      "inLanguage" : "en-US",
      "author" : "Sohn Dangen",
      "creator" : "Sohn Dangen",
      "publisher": "Sohn Dangen",
      "accountablePerson" : "Sohn Dangen",
      "copyrightHolder" : "Sohn Dangen",
      "copyrightYear" : "2020",
      "datePublished": "2020-02-23 15:27:02 \x2b0900 KST",
      "dateModified" : "2020-02-23 15:27:02 \x2b0900 KST",
      "url" : "https:\/\/dangen-effy.github.io\/post\/%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EC%A7%81%EC%A0%91-%EA%B5%AC%EC%84%B1%ED%95%98%EA%B8%B0-%EB%A1%9C%EA%B7%B8%EA%B0%80-%EC%9E%AC%EC%82%B0%EC%9D%B4%EB%8B%A4\/",
      "keywords" : [ "DevOps","Docker","Docker Compose","docker-compose","log", ]
  }
</script>
<title>ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ í´ëŸ¬ìŠ¤í„° ì§ì ‘ êµ¬ì„±í•˜ê¸° - ë¡œê·¸ê°€ ì¬ì‚°ì´ë‹¤ - ì†ë‹¹ê·¼ ê°œë°œ ë¸”ë¡œê·¸</title>
    <meta property="og:title" content="ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ í´ëŸ¬ìŠ¤í„° ì§ì ‘ êµ¬ì„±í•˜ê¸° - ë¡œê·¸ê°€ ì¬ì‚°ì´ë‹¤ - ì†ë‹¹ê·¼ ê°œë°œ ë¸”ë¡œê·¸" />
    <meta property="og:type" content="article" />
    <meta name="description" content="ë„ì»¤ ì»´í¬ì¦ˆë¡œ ì—˜ë¼ìŠ¤í‹± ì„œì¹˜ í´ëŸ¬ìŠ¤í„°ë¥¼ ë„ì›Œë´…ì‹œë‹¤" />
  
    <link rel="stylesheet" href="/css/flexboxgrid-6.3.1.min.css" />
    <link rel="stylesheet"
      href="/css/github-markdown.min.css" />
    <link rel="stylesheet" href="/css/highlight/tomorrow.min.css" />
    <link rel="stylesheet" href="/css/index.css">
    <link href="/index.xml" rel="alternate" type="application/rss+xml" title="ì†ë‹¹ê·¼ ê°œë°œ ë¸”ë¡œê·¸">
    
    <link href="https://fonts.googleapis.com/css?family=Arvo|Permanent+Marker" rel="stylesheet">
    
    
  
    <script data-ad-client="ca-pub-8860756584846944" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-158927245-1"></script>
    
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-158927245-1');
    </script>
  </head>
  

<body>
  <article class="post " id="article">
    <div class="row">
      <div class="col-xs-12 col-sm-10 col-md-8 col-sm-offset-1 col-md-offset-2 col-lg-6 col-lg-offset-3">
        <div class="site-header">
          
<header>
  <div class="signatures site-title">
    <a href="/">ğŸ¥•ì„±ê³µí•œ ì Šì€ì´</a>
  </div>
</header>
<div class="row end-xs">
  
  
</div>
<div class="header-line"></div>

        </div>
        <header class="post-header">
          <h1 class="post-title">ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ í´ëŸ¬ìŠ¤í„° ì§ì ‘ êµ¬ì„±í•˜ê¸° - ë¡œê·¸ê°€ ì¬ì‚°ì´ë‹¤</h1>
          
          <div class="row post-desc">
            <div class="col-xs-6">
              
              <time class="post-date" datetime="2020-02-23 15:27:02 KST">
                23 Feb 2020
              </time>
              
            </div>
            <div class="col-xs-6">
              
              <div class="post-author">
                <a target="_blank" href="https://dangen-effy.github.io/">@Sohn Dangen</a>
              </div>
              
            </div>
          </div>
          
        </header>

        <div class="post-content markdown-body">
          <p>ë¦¬ëª¨íŠ¸ëª¬ìŠ¤í„°ëŠ” ë‹¤ì–‘í•œ í˜•íƒœì˜ ë¡œê·¸ë¥¼ ìˆ˜ì§‘í•´ ì ìˆ˜ë¥¼ ë§¤ê²¨ í†µí™”/ë°©ì†¡ì˜ í’ˆì§ˆì„ ì¸¡ì •í•©ë‹ˆë‹¤. ğŸ“ˆ</p>
<p>ì˜ˆë¥¼ ë“¤ì–´, ì–´ëŠ êµ¬ê°„ì—ì„œ íŒ¨í‚· ì†ì‹¤ì´ ë§ì´ ì¼ì–´ë‚˜ëŠ”ì§€ í˜¹ì€ ì–´ë–¤ ë„¤íŠ¸ì›Œí¬ ìƒí™©ì—ì„œ ì‹¤íŒ¨ìœ¨ì´ ë†’ì€ì§€ ë“± ë‹¤ì–‘í•œ ì§€í‘œë¥¼ ëª¨ë¸ë§í•˜ê³  ê°œì„  ì ì„ ë„ì¶œí•©ë‹ˆë‹¤. ì¦‰ ë¡œê·¸ì˜ ì†ì‹¤ì€ ì €í¬ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ì¸ì‚¬ì´íŠ¸ì˜ ì†ì‹¤ì— ì§ê²°ë©ë‹ˆë‹¤. ë•Œë¬¸ì— ì–´ë–»ê²Œë“  ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ ê°™ì€ ë¡œê·¸ ì €ì¥ì†Œì˜ ì•ˆì •ì„±ì„ í™•ë³´ í•˜ëŠ”ë° ëª©ìˆ¨ì„ ê±¸ì–´ì•¼ í•©ë‹ˆë‹¤. ì„œë¹„ìŠ¤ê°€ ì•ˆì •ì ì¸ ìƒíƒœì—ì„œ ë‚¨ëŠ”ê±´ ë¡œê·¸ ë°–ì— ì—†ê±°ë“ ìš” :)</p>
<p>ì´ì œë¶€í„° ì œê°€ ë¦¬ëª¨íŠ¸ëª¬ìŠ¤í„°ì—ì„œ ì‹±ê¸€ ë…¸ë“œë¡œ ìš´ì˜í•˜ë˜ ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ë¥¼ ë©€í‹° í´ëŸ¬ìŠ¤í„° í˜•íƒœë¡œ ì „í™˜ì‹œí‚¨ ê²½í—˜ì„ í† ëŒ€ë¡œ í´ëŸ¬ìŠ¤í„° êµ¬ì¶• ë°©ë²•ì„ ê°„ëµíˆ í’€ì–´ ë‚˜ê°€ë ¤ê³  í•©ë‹ˆë‹¤.</p>
<p>ì›ë¡ ì ì¸ ì§ˆë¬¸ë¶€í„° ì‹œì‘í•˜ë©´ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•˜ëŠ” ì´ìœ ëŠ” ë­˜ ê¹Œìš”? ì‹±ê¸€ ë…¸ë“œë¡œ ì˜ ëŒì•„ê°€ë˜ ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ë¥¼ êµ³ì´ ë©€í‹° í´ëŸ¬ìŠ¤í„°ë¡œ ì—…ê·¸ë ˆì´ë“œ ì‹œí‚¨ ì´ìœ ê°€ ë­˜ ê¹Œìš”?</p>
<p><strong>ì²«ì§¸ë¡œ</strong> ë‹¤ì¤‘ ê°€ìš©ì˜ì—­ì— í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì¶•ì‹œì¼œ ê°€ìš©ì„±ì„ í–¥ìƒ ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ ì‹±ê¸€ ë…¸ë“œë¡œ ëŒì•„ê°€ë˜ ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ê°€ ì¢…ë£Œë˜ê±°ë‚˜ ê°€ìš© ì˜ì—­ì— ë¬¸ì œê°€ ìƒê¸°ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”? ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ ì„œë¹„ìŠ¤ ì „ì²´ê°€ ì¢…ë£Œ ë  ê²ë‹ˆë‹¤.</p>
<p>ë§Œì•½ì— A, B, C ê°€ìš© ì˜ì—­ì— í´ëŸ¬ìŠ¤í„°ë¥¼ ë°°ì¹˜ ì‹œì¼°ë‹¤ë©´? íŠ¹ì • í´ëŸ¬ìŠ¤í„°ê°€ ì£½ìœ¼ë©´ ë‚˜ë¨¸ì§€ B, C í´ëŸ¬ìŠ¤í„°ê°€ ëŒì•„ê°€ê³  A í´ëŸ¬ìŠ¤í„°ëŠ” ì¬ ì‹œì‘í•˜ë©´ ê·¸ë§Œì…ë‹ˆë‹¤. í´ëŸ¬ìŠ¤í„°ë¥¼ ì´ìš©í•œ ê³ ê°€ìš©ì„± í™•ë³´ ì´ë¡ ì€ <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/high-availability.html">Set up a cluster for high availability</a> ì—ì„œ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
<p><strong>ë‘˜ì§¸ë¡œ</strong> ë¡¤ë§ ì—…ê·¸ë ˆì´ë“œ(Rolling upgrade)ë¥¼ í†µí•œ ë¬´ì¤‘ë‹¨ ë²„ì „ ì—…ê·¸ë ˆì´ë“œë¥¼ ê°€ëŠ¥ì¼€í•©ë‹ˆë‹¤. ë§Œì•½ ì‹±ê¸€ ë…¸ë“œë¡œ ëŒê³  ìˆë‹¤ë©´ ë²„ì „ ì—…ê·¸ë ˆì´ë“œë¥¼ ìœ„í•´ ì¬ ì‹œì‘ í•˜ëŠ” ë™ì•ˆ ë‹¤ìš´ íƒ€ì„ì´ ìƒê¸°ê²Œ ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ í´ëŸ¬ìŠ¤í„° í™˜ê²½ì—ì„  A, B, C ë…¸ë“œë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì¬ ì‹œì‘í•˜ê¸° ë•Œë¬¸ì— ë‹¤ìš´ íƒ€ì„ ì—†ì´ ë²„ì „ ì—…ê·¸ë ˆì´ë“œê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
<p><strong>ì…‹ì§¸ë¡œ</strong> í™•ì¥ì— ìš©ì´í•©ë‹ˆë‹¤. ì„œë¹„ìŠ¤ê°€ ì„±ì¥í•´ ë¡œê·¸ì˜ ì–‘ì´ ëŠ˜ì–´ë‚˜ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œìš”? ë§Œì•½ ì‹±ê¸€ ë…¸ë“œë¡œ ìš´ì˜í•œë‹¤ë©´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì ì‹œ ì¤‘ë‹¨í•œ ë’¤ ìˆ˜ì§ì  í™•ì¥ì„ ê³ ë ¤ í•´ì•¼ í•  ê²ë‹ˆë‹¤. í•˜ì§€ë§Œ í´ëŸ¬ìŠ¤í„°ë¥¼ ìš´ì˜í•˜ê³  ìˆë‹¤ë©´ ì–´ë– í•œ ë‹¤ìš´ íƒ€ì„ ì—†ì´ ìƒˆë¡œìš´ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì¶•í•˜ê³  ì´ë¥¼ í´ëŸ¬ìŠ¤í„° ê·¸ë£¹ì— í• ë‹¹ í•´ì£¼ë©´ ê·¸ë§Œì…ë‹ˆë‹¤. (ìˆ˜í‰ì  í™•ì¥)</p>
<p><a href="https://github.com/dangen-effy/elasticsearch-cluster-docker-compose">í”„ë¡œì íŠ¸ ë°”ë¡œê°€ê¸°</a>: <a href="https://github.com/dangen-effy/elasticsearch-cluster-docker-compose">https://github.com/dangen-effy/elasticsearch-cluster-docker-compose</a></p>
<h2 id="í´ëŸ¬ìŠ¤í„°-ì§ì ‘-êµ¬ì¶•í•˜ê¸°">í´ëŸ¬ìŠ¤í„° ì§ì ‘ êµ¬ì¶•í•˜ê¸°</h2>
<p>í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì€ ë‘ ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.</p>
<ul>
<li>
<p>Ansible, AWS CloudFormation í˜¹ì€ Helm ì„ ì´ìš©í•´ì„œ ë¹„êµì  ì‰½ê²Œ êµ¬ì¶•í•˜ê¸°</p>
</li>
<li>
<p>Docker Compose í˜¹ì€ ë°”ì´ë„ˆë¦¬ íŒŒì¼ë¡œ ì§ì ‘ êµ¬ì¶•í•˜ê¸° (ì¡°ê¸ˆ ë…¸ê°€ë‹¤)</p>
</li>
</ul>
<p>ì €ëŠ” í›„ìë¥¼ ì„ íƒ í–ˆìŠµë‹ˆë‹¤. ì „ìëŠ” í•œ ë‹¨ê³„ ë” ì¶”ìƒí™” ë¼ìˆê¸° ë•Œë¬¸ì— ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ í´ëŸ¬ìŠ¤í„°ë¥¼ ì§ì ‘ ì˜¬ë ¤ë³¸ ê²½í—˜ ì—†ì´ ì§„í–‰í•˜ë‹¤ë³´ë©´ ë¬¸ì œê°€ ìƒê²¼ì„ë•Œ ë‚´ê°€ ì–´ëŠ êµ¬ê°„ì—ì„œ ì‚½ì§ˆí•˜ê³  ìˆëŠ”ì§€ ë””ë²„ê¹…í•˜ê¸° í˜ë“¤ê²ƒ ê°™ì•˜ìŠµë‹ˆë‹¤. ë°˜ë©´ì— Docker Compose í˜¹ì€ ë°”ì´ë„ˆë¦¬ë¡œ í•œë•€ í•œë•€ ì˜µì…˜ì„ ë„£ì–´ê°€ë©° ì¸ìŠ¤í„´ìŠ¤ì— í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì¶•í•˜ë©´ ì–´ë–¤ ì˜µì…˜ì´ ì¤‘ìš”í•˜ê³  í•„ìˆ˜ í•„ë“œì¸ì§€, ì–´ë–¤ ì›ë¦¬ë¡œ ëŒì•„ê°€ëŠ”ì§€ íŒŒì•… í•  ìˆ˜ ìˆê±°ë“ ìš”.</p>
<p>í•˜ì§€ë§Œ ì•ìœ¼ë¡œ í•œ ë²ˆ ë” êµ¬ì¶•í•˜ë ¤ê³  í•˜ë©´ Helm ì“°ë ¤ê³ ìš”.</p>
<h2 id="1-ë‹¤ì¤‘-ê°€ìš©ì˜ì—­-í™•ë³´í•˜ê¸°">1. ë‹¤ì¤‘ ê°€ìš©ì˜ì—­ í™•ë³´í•˜ê¸°</h2>
<p>ë¨¼ì € 3 ê°€ì§€ ì´ìƒì˜ ê°ê¸° ë‹¤ë¥¸ ê°€ìš©ì˜ì—­ì— ì¸ìŠ¤í„´ìŠ¤ ìì›ì„ í™•ë³´í•´ì£¼ì„¸ìš”.</p>
<h2 id="2-í´ëŸ¬ìŠ¤í„°-êµ¬ì¶•í•˜ê¸°">2. í´ëŸ¬ìŠ¤í„° êµ¬ì¶•í•˜ê¸°</h2>
<p>ì´ì œ docker-compose.yml íŒŒì¼ì„ ì‘ì„± í•´ë´…ì‹œë‹¤. ìš°ë¦¬ê°€ ë„ìš¸ ì„œë¹„ìŠ¤ëŠ”</p>
<ul>
<li>
<p>Elastic Node* 3</p>
</li>
<li>
<p>Nginx * 3</p>
</li>
<li>
<p>Kibana * 1</p>
</li>
</ul>
<p>ì…ë‹ˆë‹¤. Nginx ëŠ” ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ë¡œ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ(80 =&gt; 9200)ë¥¼ ë‹´ë‹¹í•˜ê³  VPC ë‚´ë¶€ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ í•©ì‹œë‹¤.</p>
<p><img src="https://cdn-images-1.medium.com/max/2364/1*BFwVg40h_cd7k6pN5xh2Gg.png" alt="í´ëŸ¬ìŠ¤í„° í† í´ë¡œì§€"><em>í´ëŸ¬ìŠ¤í„° í† í´ë¡œì§€</em></p>
<h2 id="ë„ì»¤-ì»´í¬ì¦ˆ-ì „ì²´-ë³´ê¸°">ë„ì»¤ ì»´í¬ì¦ˆ ì „ì²´ ë³´ê¸°</h2>
<pre><code>version: '2.1'
services:
  elastic01:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.5.1
    container_name: es01
    environment:
      - node.name=es01-node
      - cluster.name=es-docker-cluster
      - cluster.initial_master_nodes=es03-node,es01-node,es02-node
      - discovery.seed_hosts=es01.example.com:9300,es02.example.com:9300,es03.example.com:9300
      - bootstrap.memory_lock=true
      - &quot;ES_JAVA_OPTS=-Xms4g -Xmx4g&quot;
      - network.host=0.0.0.0
      - node.master=true
      - node.data=true
      - discovery.zen.minimum_master_nodes=1
      - http.port=9200
      - transport.tcp.port=9300
      - network.publish_host=${INTERNAL_HOST}
      - xpack.security.enabled=true
      - ELASTIC_PASSWORD=my_password
      - path.repo=/usr/share/elasticsearch/backup
    
    ulimits:
      memlock:
        soft: -1
        hard: -1
    volumes:
      - data01:/usr/share/elasticsearch/data
      - backup:/usr/share/elasticsearch/backup
    extra_hosts:
      - &quot;es01.example.com:172.26.2.66&quot;
      - &quot;es02.example.com:172.26.4.100&quot;
      - &quot;es03.example.com:172.31.6.133&quot;
    ports:
      - 9300:9300
    networks:
      - elastic
    restart: always
â€‹
  elastic02:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.5.1
    container_name: es02
    environment:
      - node.name=es02-node
      - cluster.name=es-docker-cluster
      - cluster.initial_master_nodes=es03-node,es01-node,es02-node
      - discovery.seed_hosts=es01.example.com:9300,es02.example.com:9300,es03.example.com:9300
      - bootstrap.memory_lock=true
      - &quot;ES_JAVA_OPTS=-Xms4g -Xmx4g&quot;
      - network.host=0.0.0.0
      - node.master=true
      - node.data=true
      - discovery.zen.minimum_master_nodes=1
      - http.port=9200
      - transport.tcp.port=9300
      - network.publish_host=${INTERNAL_HOST}
      - xpack.security.enabled=true
      - ELASTIC_PASSWORD=my_password
      - path.repo=/usr/share/elasticsearch/backup
    
    ulimits:
      memlock:
        soft: -1
        hard: -1
    volumes:
      - data02:/usr/share/elasticsearch/data
      - backup:/usr/share/elasticsearch/backup
    extra_hosts:
      - &quot;es01.example.com:172.26.2.66&quot;
      - &quot;es02.example.com:172.26.4.100&quot;
      - &quot;es03.example.com:172.31.6.133&quot;
    ports:
      - 9300:9300
    networks:
      - elastic
    restart: always
â€‹
  elastic03:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.5.1
    container_name: es03
    environment:
      - node.name=es03-node
      - cluster.name=es-docker-cluster
      - cluster.initial_master_nodes=es03-node,es01-node,es02-node
      - discovery.seed_hosts=es01.example.com:9300,es02.example.com:9300,es03.example.com:9300
      - bootstrap.memory_lock=true
      - &quot;ES_JAVA_OPTS=-Xms4g -Xmx4g&quot;
      - network.host=0.0.0.0
      - node.master=true
      - node.data=true
      - discovery.zen.minimum_master_nodes=1
      - http.port=9200
      - transport.tcp.port=9300
      - network.publish_host=${INTERNAL_HOST}
      - xpack.security.enabled=true
      - ELASTIC_PASSWORD=my_password
      - path.repo=/usr/share/elasticsearch/backup
â€‹
    ulimits:
      memlock:
        soft: -1
        hard: -1
    volumes:
      - data03:/usr/share/elasticsearch/data
      - backup:/usr/share/elasticsearch/backup
    extra_hosts:
      - &quot;es01.example.com:172.26.2.66&quot;
      - &quot;es02.example.com:172.26.4.100&quot;
      - &quot;es03.example.com:172.31.6.133&quot;
    ports:
      - 9300:9300
    networks:
      - elastic
    restart: always
    
  kibana:
    image: docker.elastic.co/kibana/kibana:7.5.1
    container_name: kibana7
    volumes:
      - ./kibana/config/kibana.yml:/usr/share/kibana/config/kibana.yml
    ports:
      - 5601:5601
    restart: always
â€‹
  elasticsearch-node1-proxy:
    image: nginx:latest
    container_name: elasticsearch-proxy-nginx
    ports:
      - 80:80
    volumes:
      - ./proxy/elasticsearch-node1-nginx.conf:/etc/nginx/nginx.conf
    networks:
      - elastic
â€‹
  elasticsearch-node2-proxy:
    image: nginx:latest
    container_name: elasticsearch-proxy-nginx
    ports:
      - 80:80
    volumes:
      - ./proxy/elasticsearch-node2-nginx.conf:/etc/nginx/nginx.conf
    networks:
      - elastic
      
  elasticsearch-node3-proxy:
    image: nginx:latest
    container_name: elasticsearch-proxy-nginx
    ports:
      - 80:80
    volumes:
      - ./proxy/elasticsearch-node3-nginx.conf:/etc/nginx/nginx.conf
    networks:
      - elastic
â€‹
volumes:
  data01:
    driver: local
  data02:
    driver: local
  data03:
    driver: local
  backup:
    driver: local
â€‹
networks:
  elastic:
    driver: bridge
</code></pre>
<ul>
<li>
<p>node.name: ë…¸ë“œì— í• ë‹¹ í•˜ëŠ” ê³ ìœ í•œ ì´ë¦„ì…ë‹ˆë‹¤. cluster.initial_master_nodes ì˜µì…˜ì—ì„œ ì´ í•„ë“œë¥¼ ì°¸ì¡°í•˜ë¯€ë¡œ ì˜ ë¶€ì—¬í•´ì£¼ì„¸ìš”.</p>
</li>
<li>
<p>cluster.name: í´ëŸ¬ìŠ¤í„° ê·¸ë£¹ì— ë¶™ì—¬ì§€ëŠ” ì´ë¦„ì…ë‹ˆë‹¤. ê°™ì€ í´ëŸ¬ìŠ¤í„° ê·¸ë£¹ìœ¼ë¡œ ì—˜ë¼ìŠ¤í‹± ë…¸ë“œê°€ ë¬¶ì´ê¸° ìœ„í•´ì„œëŠ” ë™ì¼í•œ ì´ë¦„ì„ ê³µìœ  í•´ì•¼í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ëª¨ë“  ë…¸ë“œì— es-docker-cluster ë¼ëŠ” ê°’ì„ í• ë‹¹ í•´ì¤¬ìŠµë‹ˆë‹¤.</p>
</li>
<li>
<p>cluster.initial_master_nodes: í´ëŸ¬ìŠ¤í„°ë¥¼ ê°€ë™ì‹œí‚¤ë©´ &ldquo;ë¶€íŠ¸ìŠ¤íŠ¸ë˜í•‘&rdquo; ë‹¨ê³„ë¥¼ ê±°ì¹©ë‹ˆë‹¤. ì´ ë‹¨ê³„ì—ì„œ ë§ˆìŠ¤í„° ë…¸ë“œë¡œ íˆ¬í‘œ ê°€ëŠ¥í•œ í›„ë³´ê°€ ëˆ„ê°€ ìˆëŠ”ì§€ ê²°ì •í•˜ëŠ”ë° ì´ ê°’ì„ ì°¸ì¡°í•©ë‹ˆë‹¤.</p>
</li>
<li>
<p>discovery.seed_hosts: ë…¸ë“œê°„ ë””ìŠ¤ì»¤ë²„ë¦¬ ë‹¨ê³„ì—ì„œ ì°¸ì¡° ê°€ëŠ¥ í•œ í˜¸ìŠ¤íŠ¸ì˜ ì‹œë“œë¥¼ ì œê³µí•©ë‹ˆë‹¤. <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/discovery-settings.html">ë”ë³´ê¸°</a></p>
</li>
<li>
<p>&ldquo;ES_JAVA_OPTS=-Xms4g -Xmx4g&rdquo;: JVMì´ ì‚¬ìš© ê°€ëŠ¥í•œ í™ ì‚¬ì´ì¦ˆë¥¼ ê²°ì •í•©ë‹ˆë‹¤. ë©”ëª¨ë¦¬ ìŠ¤í™ì— ë”°ë¼ ë‹¤ë¥¸ ê°’ì„ ê°€ì§‘ë‹ˆë‹¤. <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/heap-size.html">ë”ë³´ê¸°</a></p>
</li>
<li>
<p>node.master node.data: í•´ë‹¹ ë…¸ë“œê°€ ë§¡ì„ ìˆ˜ ìˆëŠ” ì—­í• ì„ ì§€ì •í•©ë‹ˆë‹¤. ì´ í¬ìŠ¤íŒ…ì€ master ë…¸ë“œì™€ data ë…¸ë“œë§Œ ì‚¬ìš©í•˜ê³  ìˆì§€ë§Œ, ì—˜ë¼ìŠ¤í‹± í´ëŸ¬ìŠ¤í„°ëŠ” ì—­í• ì— ë”°ë¼ ë…¸ë“œë¥¼ ì„¸ë¶„í™” í•´ì„œ êµ¬ì¶• ê°€ëŠ¥í•©ë‹ˆë‹¤. <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.5/modules-node.html">ë”ë³´ê¸°</a></p>
</li>
<li>
<p>network.publish_host: ë…¸ë“œ &lt;=&gt; ë…¸ë“œ ê°„ í†µì‹ ì„(9300 í¬íŠ¸) í•˜ê¸° ìœ„í•´ í¼ë¸”ë¦¬ì‹± í•  í˜¸ìŠ¤íŠ¸ ì£¼ì†Œë¥¼ í• ë‹¹í•©ë‹ˆë‹¤. ë…¸ë“œ ê°„ í†µì‹ ì€ VPC ì™¸ë¶€ì—ì„œ ì°¸ì¡° í•  ì¼ì´ ì—†ìœ¼ë¯€ë¡œ ì¸ìŠ¤í„´ìŠ¤ì˜ ë‚´ë¶€ IP ë¡œ í• ë‹¹ í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤. ${INTERNAL_HOST} ë¥¼ ì ì ˆíˆ êµì²´ í•´ì£¼ì„¸ìš”.</p>
</li>
<li>
<p>path.repo: ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ëŠ” repository ë¼ëŠ” ë°±ì—… ì €ì¥ì†Œ ê°œë…ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. API í˜¸ì¶œë¡œ repositoryì— ìŠ¤ëƒ…ìƒ·ì„ ë””ìŠ¤í¬ì— ì €ì¥í•˜ê±°ë‚˜ í´ë¼ìš°ë“œ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•˜ê³  ë³µì› í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <a href="https://www.elastic.co/guide/en/elasticsearch/plugins/current/repository.html">ë”ë³´ê¸°</a></p>
</li>
</ul>
<p>ì´ì œ ë„ì»¤ ì»´í¬ì¦ˆ ì˜µì…˜ì„ ì‚´í´ë´…ì‹œë‹¤.</p>
<h2 id="elastic-ë„ì»¤-ì»´í¬ì¦ˆ-ì‚´í´ë³´ê¸°">Elastic ë„ì»¤ ì»´í¬ì¦ˆ ì‚´í´ë³´ê¸°</h2>
<h3 id="volume">volume</h3>
<p>ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ Stateful ì• í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤. ì»¨í…Œì´ë„ˆì˜ ìˆ˜ëª…ì´ ë‹¤í•´ë„ ë°ì´í„°ë¥¼ ë‚¨ê¸°ê¸° ìœ„í•´ Named Volume íƒ€ì…ìœ¼ë¡œ ë³¼ë¥¨ì„ ì •ì˜í•´ì¤ì‹œë‹¤. ì´ì œ 1ë²ˆ ë…¸ë“œì˜ ë°ì´í„°ëŠ” ë„ì»¤ì˜ data01 ë³¼ë¥¨ì— ìŒ“ì´ê²Œë©ë‹ˆë‹¤. ë˜í•œ ìŠ¤ëƒ…ìƒ·ì„ ë‚¨ê¸°ê¸° ìœ„í•´ path.repo ì˜µì…˜ì—ì„œ ê°€ë¦¬í‚¤ê³  ìˆëŠ” /usr/share/elasticsearch/backup í´ë”ë„ Named Volume ìœ¼ë¡œ ì§€ì •í•©ë‹ˆë‹¤.</p>
<pre><code>volumes:
      - data01:/usr/share/elasticsearch/data
      - backup:/usr/share/elasticsearch/backup
volumes:
      - data02:/usr/share/elasticsearch/data
      - backup:/usr/share/elasticsearch/backup
volumes:
      - data03:/usr/share/elasticsearch/data
      - backup:/usr/share/elasticsearch/backup
      
[...]

volumes:
  data01:
    driver: local
  data02:
    driver: local
  data03:
    driver: local
  backup:
    driver: local
</code></pre>
<h3 id="extra_hosts">extra_hosts</h3>
<p>ë…¸ë“œ ê°„ ë””ìŠ¤ì»¤ë²„ë¦¬ë¥¼ ìœ„í•´ í˜¸ìŠ¤íŠ¸ë¥¼ ë“±ë¡í•´ì¤ë‹ˆë‹¤. ë•ë¶„ì— discovery.seed_hosts í•„ë“œì—ì„œ es01.example.com ë¥¼ ë‚´ë¶€ ì•„ì´í”¼ë¡œì¨ ì°¸ì¡° í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<pre><code>extra_hosts:
      - &quot;es01.example.com:172.26.2.66&quot;
      - &quot;es02.example.com:172.26.4.100&quot;
      - &quot;es03.example.com:172.31.6.133&quot;
</code></pre>
<h3 id="networks">networks</h3>
<p>ì—˜ë¼ìŠ¤í‹± í´ëŸ¬ìŠ¤í„°ì™€ Nginx ì˜ ì»¨í…Œì´ë„ˆê°„ ë„¤íŠ¸ì›Œí¬ë¥¼ ê°œë°©í•´ì•¼ í•˜ë¯€ë¡œ Bridge ë„¤íŠ¸ì›Œí¬ë¡œ ë¬¶ì–´ì¤ë‹ˆë‹¤.</p>
<pre><code>networks:
      - elastic
      
[...]

networks:
  elastic:
    driver: bridge
</code></pre>
<h2 id="nginx-ë„ì»¤-ì»´í¬ì¦ˆ-ì‚´í´ë³´ê¸°">Nginx ë„ì»¤ ì»´í¬ì¦ˆ ì‚´í´ë³´ê¸°</h2>
<h3 id="volumes">volumes</h3>
<p>Nginx ì½˜í”½ì„ ë„£ì–´ì¤˜ì•¼ í•˜ë¯€ë¡œ Bind Mount ë¥¼ í•´ì¤ì‹œë‹¤.</p>
<pre><code>volumes:
      - ./proxy/elasticsearch-node1-nginx.conf:/etc/nginx/nginx.conf
</code></pre>
<h3 id="nginx-ì½˜í”½">Nginx ì½˜í”½</h3>
<p>ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ëŠ” ì™¸ë¶€ IP ì ‘ê·¼ì„ í—ˆìš© í•  í•„ìš”ê°€ ì—†ìœ¼ë¯€ë¡œ server_name ì„ ${INTERNAL_HOST} ë¡œ ì œí•œí•´ì¤ì‹œë‹¤. elasticsearch-node2-nginx.conf, elasticsearch-node3-nginx.conf ë„ ê°’ì„ ë³€ê²½í•´ì£¼ì„¸ìš”.</p>
<pre><code>user  nginx;
worker_processes  1;
error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;
events {                     
    worker_connections  1024;
}

http {

upstream elasticsearch-container-host {
       server elastic01:9200;
    }

server {
        listen 80;

server_name ${INTERNAL_HOST}; # ë‚´ë¶€ ì•„ì´í”¼ë¡œë§Œ ì ‘ê·¼ì‹œ ìš”ì²­ í—ˆìš©

location / {
            proxy_pass [http://elasticsearch-container-host](http://elasticsearch-container-host);

proxy_read_timeout 90000;
            proxy_http_version 1.1;
            proxy_set_header X-Forwarded-Host $host;
            proxy_set_header Upgrade $http_upgrade;
        }
    }

sendfile        on;                                                                
    keepalive_timeout  65;                                                                      
    include /etc/nginx/conf.d/*.conf;           
}
</code></pre>
<h2 id="kibana-ë„ì»¤-ì»´í¬ì¦ˆ-ì‚´í´ë³´ê¸°">Kibana ë„ì»¤ ì»´í¬ì¦ˆ ì‚´í´ë³´ê¸°</h2>
<h3 id="volumes-1">volumes</h3>
<p>í‚¤ë°”ë‚˜ë„ ì½˜í”½ íŒŒì¼ì´ í•„ìš”í•˜ê¸° ë•Œë¬¸ì— Bind Mount ì‹œì¼œì¤ì‹œë‹¤.</p>
<pre><code>volumes:
      - ./kibana/config/kibana.yml:/usr/share/kibana/config/kibana.yml
</code></pre>
<h3 id="kibanayml">kibana.yml</h3>
<pre><code>server.name: kibana
server.port: 5601
server.host: &quot;0.0.0.0&quot;
elasticsearch.username: elastic
elasticsearch.password: my_password

# Elasticsearch Nginx ê°€ 80 -&gt; 9200 í”„ë¡ì‹±ì„ í•˜ê¸°ë•Œë¬¸ì— í¬íŠ¸ ì—†ì´ ì”€
elasticsearch.hosts: [ &quot;[http://172.26.2.66](http://172.26.2.66)&quot;, &quot;172.26.4.100&quot;, &quot;172.31.6.133&quot; ]

xpack.security.enabled: true

server.cors: true
server.cors.origin: ['*']
</code></pre>
<p>ì´ì œ ëª¨ë“  ì„¸íŒ…ì€ ëë‚¬ìŠµë‹ˆë‹¤. í•œ ë²ˆ ì •ë¦¬í•´ë³¼ê¹Œìš”?</p>
<pre><code>$ tree .
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ kibana
â”‚   â””â”€â”€ config
â”‚       â””â”€â”€ kibana.yml
â””â”€â”€ proxy
    â”œâ”€â”€ elasticsearch-node1-nginx.conf
    â”œâ”€â”€ elasticsearch-node2-nginx.conf
    â””â”€â”€ elasticsearch-node3-nginx.conf
</code></pre>
<h2 id="í˜„-êµ¬ì¡°ì˜-í•œê³„ì ">í˜„ êµ¬ì¡°ì˜ í•œê³„ì </h2>
<p>í´ëŸ¬ìŠ¤í„°ì˜ í•µì‹¬ì€ ìˆ˜í‰ì  í™•ì¥ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì§€ê¸ˆì€ ì¸ìŠ¤í„´ìŠ¤ì˜ ìƒíƒœì— ë”°ë¼ ì½˜í”½ íŒŒì¼ì— ê°’ì„ ì§ì ‘ í•˜ë“œì½”ë”© í–ˆê¸° ë•Œë¬¸ì— ìë™í™”ëœ ìˆ˜í‰ì  í™•ì¥ì€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
<p>ê°€ë ¹ ë“¤ì–´ì˜¤ëŠ” ë¡œê·¸ëŸ‰ì´ ì¦ê°€ í–ˆì„ë•Œ ìƒˆ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í•œ ëŒ€ ë„ìš°ê³  í´ëŸ¬ìŠ¤í„° ê·¸ë£¹ì— ìƒˆ ë…¸ë“œë¥¼ í• ë‹¹ í•˜ë ¤ë©´ ì–´ë–¤ ì‘ì—…ì„ í•´ì•¼ í• ê¹Œìš”? ìƒˆë¡­ê²Œ ë„ìš´ ì¸ìŠ¤í„´ìŠ¤ì˜ ë‚´ë¶€ ì•„ì´í”¼ì™€ ë…¸ë“œì˜ ì´ë¦„ì„ ì•Œì•„ì•¼ í•˜ë¯€ë¡œ cluster.initial_master_nodes ì™€ discovery.seed_hosts ì— ìƒˆ ë…¸ë“œì˜ ì •ë³´ë¥¼ ì¶”ê°€í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤. ë˜í•œ í‚¤ë°”ë‚˜ ì½˜í”½ì˜ elasticsearch.hosts í•„ë“œë„ ìˆ˜ì •í•´ì¤˜ì•¼ê² ì£ .</p>
<p>ì¦‰ ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ë¥¼ ì‚¬ëŒì´ ì† ìˆ˜ í•´ì¤˜ì•¼ í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ëŠ” ë³´í†µ ê·€ì°®ì€ ì‘ì—…ì´ ì•„ë‹ë¿ë”ëŸ¬ ì‹¤ìˆ˜ë¥¼ ìœ ë°œí•˜ê² ì£ . ì´ë¥¼ í•´ê²°í•˜ë ¤ë©´ ì„œë¹„ìŠ¤ ë“±ë¡ì— ììœ ë¡œìš´ Kubernetes ê°™ì€ ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ íˆ´ì„ ì‚¬ìš©í•´ì•¼í•©ë‹ˆë‹¤.</p>

        </div>

        <div class="row middle-xs">
          <div class="col-xs-12">
            
            <div class="post-category">
              <a href="/categories/devops/">
                DevOps
              </a>
            </div>
            
            <div class="post-category">
              <a href="/categories/elastic/">
                Elastic
              </a>
            </div>
            
            <div class="post-category">
              <a href="/categories/elasticsearch/">
                Elasticsearch
              </a>
            </div>
            
          </div>
        </div>

        
        

<div class="releated-content">
  <h3>Related Posts</h3>
  <ul>
    
    <li><a href="/post/%EA%B0%80%EB%82%9C%ED%95%9C-%EC%8A%A4%ED%83%80%ED%8A%B8%EC%97%85%EC%9D%98-webrtc-%EB%B9%84%EC%9A%A9%EC%A0%88%EA%B0%90-%EC%9C%84%ED%95%9C-%EA%B3%A0%EA%B5%B0%EB%B6%84%ED%88%AC%EA%B8%B0/">ê°€ë‚œí•œ ìŠ¤íƒ€íŠ¸ì—…ì˜ WebRTC ë¹„ìš©ì ˆê° ìœ„í•œ ê³ êµ°ë¶„íˆ¬ê¸°</a></li>
    
    <li><a href="/post/%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C-%EB%84%A4%EC%9D%B4%ED%8B%B0%EB%B8%8C-%EC%9D%B8%ED%94%84%EB%9D%BC%EC%8A%A4%ED%8A%B8%EB%9F%AD%EC%B2%98%EB%9E%80/">í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ë€?</a></li>
    
    <li><a href="/post/janus-%EC%86%8C%EA%B0%9C%EC%99%80-docker-%EA%B8%B0%EB%B0%98%EC%9C%BC%EB%A1%9C-%EC%89%BD%EA%B2%8C-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0/">Janus ì†Œê°œì™€ Docker ê¸°ë°˜ìœ¼ë¡œ ì‰½ê²Œ ì‚¬ìš©í•˜ê¸°</a></li>
    
  </ul>
</div>

        
        
        <div style="height: 50px;"></div>
        
        <div class="post-comments">
          <div id="disqus_thread"></div>
<script>
  window.addEventListener("load", () => {
    (function() {
      
      var d = document,
        s = d.createElement("script");
      s.src = "https://sohn-dangen-blog.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  });
</script>
<noscript
  >Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript"
    >comments powered by Disqus.</a
  ></noscript
>

        </div>
        
        

        <div class="site-footer">
  
  <div class="site-footer-item">
    <a href="https://dangen-effy.github.io/about" target="_blank">Me</a>
  </div>
  
  <div class="site-footer-item">
    <a href="/index.xml" target="_blank">RSS</a>
  </div>
  
  
</div>

      </div>
    </div>
  </article>

  <script src="/js/highlight.pack.js"></script>


<script>
  hljs.initHighlightingOnLoad();
  
  
  
    
    
  
</script>

  

</body>

</html>